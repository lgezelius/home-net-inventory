#!/bin/bash
set -euo pipefail

RECREATE_DB=false

for arg in "$@"; do
  case "$arg" in
    --recreate-db)
      RECREATE_DB=true
      ;;
    *)
      echo "Usage: $0 [--recreate-db]"
      exit 1
      ;;
  esac
done

git pull

if [ "$RECREATE_DB" = true ]; then
  echo "Recreating database will DELETE the existing data/inventory.db."
  read -r -p "Are you sure you want to continue? [y/N] " reply
  case "$reply" in
    [yY][eE][sS]|[yY]) ;;
    *) echo "Aborting."; exit 1 ;;
  esac
  echo "Recreating database..."
  docker compose down || true
  mkdir -p data
  rm -f data/inventory.db
fi

docker compose up -d --build
echo "Update complete!"
