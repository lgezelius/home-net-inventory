<div id="devices-table" hx-target="this">
  <div class="flex items-center justify-between px-4 pt-4 pb-3">
    <div>
      <p class="text-sm text-slate-400">
        {% if limit %}
          Showing {{ count }} of {{ total }} devices (limit {{ limit }}).
        {% else %}
          Showing all {{ total }} devices.
        {% endif %}
      </p>
    </div>
  </div>
  <div class="max-h-[70vh] overflow-auto">
    <table class="min-w-[80rem] divide-y divide-slate-800 table-fixed">
      <thead class="bg-slate-900/80">
        <tr class="text-left text-xs uppercase tracking-wide text-slate-400">
          <th class="px-4 py-3 w-48">Name</th>
          <th class="px-4 py-3 w-40">Device</th>
          <th class="px-4 py-3 w-40">MAC</th>
          <th class="px-4 py-3 w-44">IP</th>
          <th class="px-4 py-3 w-32">Vendor</th>
          <th class="px-4 py-3 w-40">Last seen</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-800">
        {% for d in devices %}
        <tr class="hover:bg-slate-800/50">
          <td class="px-4 py-3">
            <div class="text-sm font-semibold text-slate-50">{{ d.display_name or "—" }}</div>
            <div class="mt-1 flex flex-wrap gap-1">
              {% for st in d.mdns_service_types or [] %}
              {% set key = st.replace('.local.', '').rstrip('.') %}
              <span class="rounded-full bg-slate-800 px-2 py-1 text-[11px] text-slate-200 whitespace-nowrap">
                {{ service_labels.get(key, st) }}
              </span>
              {% endfor %}
            </div>
          </td>
          <td class="px-4 py-3">
            <div class="text-sm text-slate-100">{{ d.device_name or "—" }}</div>
            {% if d.mdns_txt.model %}
            <div class="text-xs text-slate-400">Model: {{ d.mdns_txt.model }}</div>
            {% endif %}
          </td>
          <td class="px-4 py-3 text-sm font-mono text-slate-200">{{ d.mac or "—" }}</td>
          <td class="px-4 py-3">
            <div class="text-sm font-mono text-slate-200">{{ d.ip or "—" }}</div>
            {% if d.hostname %}
            <div class="text-xs text-slate-400">{{ d.hostname }}</div>
            {% endif %}
          </td>
          <td class="px-4 py-3 text-sm text-slate-200">{{ d.vendor or "—" }}</td>
          <td class="px-4 py-3 text-sm text-slate-200">
            {% if d.last_seen %}
            <span data-dt="{{ d.last_seen }}">{{ d.last_seen }}</span>
            {% else %}—{% endif %}
          </td>
        </tr>
        {% endfor %}
        {% if devices|length == 0 %}
        <tr>
          <td colspan="6" class="px-4 py-6 text-center text-slate-400 text-sm">
            {% if scan_status and scan_status.running %}
              Scan is running. Devices will appear when it finishes.
            {% else %}
              No devices yet. Run a scan to populate inventory.
            {% endif %}
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>
